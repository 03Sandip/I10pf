<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Gonotes — Company Screening Lists</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Company-wise list of LeetCode problems parsed from A.txt. Click a company to view all links." />
  <link rel="canonical" href="https://gonotes.shop/pages/company-list.html" />

  <!-- site theme and header styles (colors & variables live in ../css/styles.css) -->
  <link rel="stylesheet" href="../css/styles.css" />
  <link rel="stylesheet" href="../css/pages/header.css" />

  <style>
    /* Page-specific styles (uses variables from ../css/styles.css) */
    body{font-family:Inter,system-ui,Arial;margin:18px;color:var(--text, #111);background:var(--bg, #fbf8f3)}
    .wrap{max-width:1200px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:18px}
    header h1{margin:0;font-size:20px}
    header p{margin:4px 0 0;color:var(--muted, #9a948f);font-size:13px}

    .grid{display:grid;grid-template-columns:320px 1fr;gap:20px}
    .panel{background:var(--card, #fff);border-radius:12px;padding:14px;box-shadow:var(--shadow, 0 12px 30px rgba(16,24,40,0.06))}
    .company-list{display:flex;flex-direction:column;gap:8px;max-height:72vh;overflow:auto;padding-right:6px;outline:none}

    /* company item (improved highlight + accessibility) */
    .company-item{
      display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;
      border:1px solid rgba(0,0,0,0.04);background:var(--card, #fff);cursor:pointer;
      transition:box-shadow .16s, transform .12s, background .12s, border-color .12s;
      position:relative;
      text-align:left;
    }

    /* subtle hover */
    .company-item:hover{
      transform:translateY(-2px);
      box-shadow:0 12px 30px rgba(16,24,40,0.06);
    }

    /* active accent - stronger and obvious */
    .company-item.active{
      background: linear-gradient(90deg, rgba(250,245,240,0.85) 0%, rgba(255,255,255,0.9) 100%);
      border-color: rgba(168,111,56,0.18);
      box-shadow: 0 10px 28px rgba(168,111,56,0.06);
      padding-left: 16px; /* leave space for accent bar */
    }

    /* left accent bar for active item */
    .company-item.active::before{
      content: "";
      position: absolute;
      left: 6px;
      top: 8px;
      bottom: 8px;
      width: 6px;
      border-radius: 6px;
      background: linear-gradient(180deg, var(--accent, #a86f38), color-mix(in srgb, var(--accent, #a86f38) 60%, white));
      box-shadow: 0 4px 12px rgba(168,111,56,0.18);
    }

    .company-item .cname{font-weight:700; font-size:14px; color:var(--text, #111)}
    .company-item .ccount{font-size:13px;color:var(--muted, #9a948f)}

    /* focused state for keyboard users */
    .company-item:focus{
      outline: none;
      box-shadow: 0 8px 24px rgba(168,111,56,0.06), 0 0 0 3px rgba(168,111,56,0.08);
    }

    /* ensure buttons inside list behave like list items */
    .company-item{ width: calc(100% - 2px); text-align:left; border-radius:10px; }

    .toolbar{display:flex;gap:8px;margin-bottom:12px;align-items:center}
    .toolbar input[type="search"], .toolbar select{padding:10px;border-radius:10px;border:1px solid #e6e6e6;flex:1;background:#fafafa}
    .toolbar button{padding:8px 12px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}

    /* list-row layout */
    .list-row {
      display:flex;
      align-items:center;
      gap:16px;
      padding:12px;
      border-radius:8px;
      margin-bottom:8px;
      background:var(--card, #fff);
      box-shadow:0 6px 18px rgba(16,24,40,0.02);
    }
    .list-row .left { flex: 1; min-width:0; } /* allow truncation */
    .list-title { font-weight:700; font-size:15px; line-height:1.2; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .list-meta { color:var(--muted, #9a948f); font-size:13px; margin-top:6px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .stats { display:flex; flex-direction:row; align-items:center; gap:10px; min-width:220px; justify-content:flex-end; }
    .diff-chip { padding:6px 10px; border-radius:999px; font-weight:700; background:var(--card, #fff); border:1px solid rgba(0,0,0,0.04); }
    .diff-easy{ color:var(--ok, #2fb16d) }
    .diff-medium{ color:var(--warn, #d97706) }
    .diff-hard{ color:var(--danger, #b91c1c) }

    .acceptance { padding:6px 8px; border-radius:999px; background:var(--card, #fff); border:1px solid rgba(0,0,0,0.06); font-weight:700; min-width:90px; text-align:center; }

    .solve-link { margin-left:12px; color:var(--accent, #a86f38); font-weight:700; text-decoration:none; }

    .loading, .empty { text-align:center;padding:22px;color:var(--muted, #9a948f) }

    /* small-screen tweaks */
    @media (max-width:980px){
      .grid{grid-template-columns:1fr}
      .stats { min-width:0; justify-content:flex-start; flex-wrap:wrap; }
      .acceptance { min-width:unset; }
      .company-item.active::before{ left: 10px; } /* adjust for smaller padding */
    }
  </style>
</head>
<body>

  <!-- header placeholder (loaded by loader script) -->
  <div id="header" aria-hidden="true"></div>

  <div class="grid" role="main">
    <aside class="panel" aria-label="Company list">
      <div style="display:flex;gap:8px;margin-bottom:10px">
        <input id="companySearch" placeholder="Filter companies..." aria-label="Filter companies" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6e6e6" />
        <button id="reloadBtn" title="Reload data" aria-label="Reload data">Reload</button>
      </div>

      <div id="companyList" class="company-list" tabindex="0" aria-label="Companies">
        <div id="companyLoading" class="loading">Loading companies…</div>
      </div>
      <div class="note" id="companyCount">Companies: 0</div>
    </aside>

    <section class="panel" aria-live="polite">
      <div class="toolbar" role="region" aria-label="Problem toolbar">
        <input id="problemSearch" type="search" placeholder="Filter problems or links..." aria-label="Filter problems" />
        <select id="groupFilter" aria-label="Show problems from">
          <option value="active">Active company only</option>
          <option value="all">All companies (grouped)</option>
        </select>
      </div>

      <div id="sectionTitle" style="font-weight:700;margin-bottom:6px">Select a company to view problems</div>

      <div style="overflow:auto;max-height:62vh">
        <div id="problemsContainer"></div>
      </div>

      <div class="note" id="rowCount" style="margin-top:8px">Rows: 0</div>
    </section>
  </div>

  <!-- footer placeholder -->
  <div id="footer" aria-hidden="true"></div>

  <!-- partial loader scripts (header/footer) -->
  <script src="../js/loadPartials.js" defer></script>
  <script src="../js/components.js" defer></script>

  <!-- module script (full page JS) -->
  <script type="module">
  import { fetchCompanyData } from '/js/data/company-data.js';

  const companyListEl = document.getElementById('companyList');
  const companySearch = document.getElementById('companySearch');
  const reloadBtn = document.getElementById('reloadBtn');
  const companyCountEl = document.getElementById('companyCount');

  const problemSearch = document.getElementById('problemSearch');
  const groupFilter = document.getElementById('groupFilter');
  const sectionTitle = document.getElementById('sectionTitle');
  const problemsContainer = document.getElementById('problemsContainer');
  const rowCount = document.getElementById('rowCount');

  let rawData = {};
  let companyKeys = [];
  let visibleCompanyKeys = [];
  let activeIndex = 0;

  function debounce(fn, wait=200){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), wait); }; }

  // parse trailing stats from string like "1 Two Sum 45.6% Easy 0.346..."
  function parseStats(title){
    const m = title.match(/(.*)\b(\d{1,3}(?:\.\d+)?)\%\s*(Easy|Medium|Hard)\s*([0-9]*\.?[0-9]+)?\s*$/i);
    if(!m) return { title: title.trim(), pct: null, diff: null, score: null };
    return { title: m[1].trim(), pct: m[2], diff: m[3], score: m[4] || null };
  }

  function createProblemRow(seq, item){
    const s = parseStats(item.title || '');
    let acceptanceText = '';
    if(s.score){
      const n = Number(s.score || 0) * 100;
      acceptanceText = `${n.toFixed(1)}%`;
    }
    const row = document.createElement('div');
    row.className = 'list-row';
    row.innerHTML = `
      <div class="left">
        <div class="list-title">${seq}. ${escapeHtml(s.title)}</div>
        <div class="list-meta">${escapeHtml(item.link||'')}</div>
      </div>
      <div class="stats">
        ${s.diff ? `<div class="diff-chip diff-${s.diff.toLowerCase()}">${s.diff}</div>` : ''}
        ${s.score ? `<div class="acceptance">Acceptance ${escapeHtml(acceptanceText)}</div>` : ''}
        ${item.link ? `<a class="solve-link" href="${escapeAttr(item.link)}" target="_blank" rel="noopener">Solve</a>` : ''}
      </div>
    `;
    return row;
  }

  function renderCompanyList(filter=''){
    companyListEl.innerHTML = '';
    const f = (filter||'').toLowerCase().trim();
    visibleCompanyKeys = companyKeys.filter(k => !f || k.toLowerCase().includes(f));
    if(visibleCompanyKeys.length === 0){
      companyListEl.innerHTML = `<div class="empty">No companies match “${escapeHtml(f)}”.</div>`;
      companyCountEl.textContent = 'Companies: 0';
      problemsContainer.innerHTML = `<div class="empty">No data</div>`;
      rowCount.textContent = 'Rows: 0';
      return;
    }

    visibleCompanyKeys.forEach(key => {
      const idx = companyKeys.indexOf(key);
      const count = (rawData[key] || []).length;
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'company-item' + (idx === activeIndex ? ' active' : '');
      btn.dataset.idx = idx;
      btn.setAttribute('aria-pressed', idx === activeIndex ? 'true' : 'false');
      btn.innerHTML = `<div style="text-align:left"><div class="cname">${escapeHtml(key)}</div><div class="ccount">${count} items</div></div>`;
      btn.addEventListener('click', ()=> selectCompany(idx, { smoothScroll: true }));
      btn.addEventListener('keydown', ev => {
        if(ev.key==='Enter' || ev.key===' '){
          ev.preventDefault();
          selectCompany(idx, { smoothScroll: true });
        }
      });
      companyListEl.appendChild(btn);
    });

    companyCountEl.textContent = 'Companies: ' + visibleCompanyKeys.length;

    // ensure active is within visible list; if not, pick first visible
    if(!visibleCompanyKeys.includes(companyKeys[activeIndex])){
      const fallback = companyKeys.indexOf(visibleCompanyKeys[0]);
      if(fallback >= 0) selectCompany(fallback, { smoothScroll: true });
    } else {
      // re-apply active class on DOM nodes
      Array.from(companyListEl.children).forEach(child => child.classList.toggle('active', Number(child.dataset.idx) === activeIndex));
    }
  }

  // selectCompany now optionally scrolls the active item into view and focuses it
  function selectCompany(idx, opts = { smoothScroll: false }){
    if(idx < 0 || idx >= companyKeys.length) return;
    activeIndex = idx;

    // Toggle active class on buttons
    Array.from(companyListEl.children).forEach(child => {
      const isActive = Number(child.dataset.idx) === idx;
      child.classList.toggle('active', isActive);
      child.setAttribute('aria-pressed', isActive ? 'true' : 'false');
    });

    // Update title & render problems
    const key = companyKeys[idx];
    sectionTitle.textContent = `${key} — ${ (rawData[key]||[]).length } items`;
    renderProblems();

    // focus + scroll active item into center of sidebar for visibility
    const activeBtn = companyListEl.querySelector('.company-item.active');
    if(activeBtn){
      // focus for keyboard users (and show outline)
      try { activeBtn.focus(); } catch (e) {}
      // smooth scroll when requested, otherwise instant
      if(opts.smoothScroll){
        activeBtn.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } else {
        activeBtn.scrollIntoView({ behavior: 'auto', block: 'center' });
      }
    }
  }

  function renderActiveCompany(key){
    problemsContainer.innerHTML = '';
    const list = rawData[key] || [];
    if(!list.length){
      problemsContainer.innerHTML = `<div class="empty">No problems for ${escapeHtml(key)}</div>`;
      rowCount.textContent = 'Rows: 0';
      return;
    }
    const frag = document.createDocumentFragment();
    const q = (problemSearch.value || '').toLowerCase().trim();
    let count = 0;
    list.forEach((it, i) => {
      if(q && !( (it.title||'').toLowerCase().includes(q) || (it.link||'').toLowerCase().includes(q) )) return;
      count++;
      frag.appendChild(createProblemRow(count, it));
    });
    problemsContainer.appendChild(frag);
    rowCount.textContent = 'Rows: ' + count;
  }

  async function renderGroupRowsInBatches(container, list, filterQ=''){
    container.innerHTML = '';
    const batchSize = 30;
    let i = 0;
    let seq = 0;
    function renderBatch(){
      const frag = document.createDocumentFragment();
      const end = Math.min(i + batchSize, list.length);
      for(; i < end; i++){
        const it = list[i];
        if(filterQ && !( (it.title||'').toLowerCase().includes(filterQ) || (it.link||'').toLowerCase().includes(filterQ) )) continue;
        seq++;
        frag.appendChild(createProblemRow(seq, it));
      }
      container.appendChild(frag);
      if(i < list.length) requestAnimationFrame(renderBatch);
    }
    return new Promise(res => { requestAnimationFrame(()=>{ renderBatch(); res(); }); });
  }

  function renderAllCompaniesGrouped(){
    problemsContainer.innerHTML = '';
    const q = (problemSearch.value||'').toLowerCase().trim();
    let grandCount = 0;
    visibleCompanyKeys.forEach(key => {
      const list = rawData[key] || [];
      if(q){
        const any = list.some(it => (it.title||'').toLowerCase().includes(q) || (it.link||'').toLowerCase().includes(q));
        if(!any) return;
      }
      const wrapper = document.createElement('div');
      wrapper.style.marginBottom = '12px';
      const header = document.createElement('div');
      header.className = 'group-header-row';
      header.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div style="font-weight:700">${escapeHtml(key)} — ${list.length} items</div><div><button class="small-link" data-action="toggle">Expand</button></div></div>`;
      wrapper.appendChild(header);
      const box = document.createElement('div'); box.style.marginTop = '8px'; wrapper.appendChild(box);

      header.querySelector('[data-action="toggle"]').addEventListener('click', async function toggle(){
        const btn = this;
        if(btn.dataset.state === 'expanded'){
          btn.dataset.state = 'collapsed';
          btn.textContent = 'Expand';
          box.innerHTML = '';
        } else {
          btn.dataset.state = 'expanded';
          btn.textContent = 'Collapse';
          await renderGroupRowsInBatches(box, list, q);
        }
      });

      problemsContainer.appendChild(wrapper);
      grandCount += list.length;
    });

    if(!problemsContainer.children.length){
      problemsContainer.innerHTML = `<div class="empty">No results</div>`;
    }
    rowCount.textContent = 'Rows: ' + grandCount;
  }

  function renderProblems(){
    const mode = groupFilter.value;
    if(mode === 'active'){
      const key = companyKeys[activeIndex] || '';
      renderActiveCompany(key);
    } else {
      renderAllCompaniesGrouped();
    }
  }

  function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  function escapeAttr(s){ return String(s||'').replace(/"/g,'&quot;'); }

  async function loadData(){
    try {
      companyListEl.innerHTML = '<div class="loading">Loading companies…</div>';
      sectionTitle.textContent = 'Loading…';
      const companies = await fetchCompanyData('/js/data/A.txt'); // expected array [{title, rows: [...] }]
      rawData = {};
      (companies||[]).forEach(c => rawData[c.title || 'Unknown'] = c.rows || []);
      companyKeys = Object.keys(rawData).sort((a,b)=> a.localeCompare(b, undefined, {sensitivity:'base'}));
      visibleCompanyKeys = companyKeys.slice();
      if(!companyKeys.length){
        sectionTitle.textContent = 'No companies found';
        companyListEl.innerHTML = '<div class="empty">No companies found</div>';
        problemsContainer.innerHTML = '<div class="empty">No data</div>';
        companyCountEl.textContent = 'Companies: 0';
        rowCount.textContent = 'Rows: 0';
        return;
      }
      sectionTitle.textContent = `Loaded ${companyKeys.length} companies`;
      renderCompanyList();

      // pick the first company as active by default (and smooth scroll to it)
      // if you prefer no auto-selection, remove the next two lines
      const defaultIndex = 0;
      selectCompany(defaultIndex, { smoothScroll: true });

      renderProblems();
    } catch(err){
      console.error(err);
      companyListEl.innerHTML = '<div class="empty">Failed to load companies — see console</div>';
      problemsContainer.innerHTML = '<div class="empty">Failed to load data</div>';
      sectionTitle.textContent = 'Load failed';
    }
  }

  companySearch.addEventListener('input', debounce(()=> renderCompanyList(companySearch.value)));
  problemSearch.addEventListener('input', debounce(()=> renderProblems(), 200));
  groupFilter.addEventListener('change', ()=> renderProblems());
  reloadBtn.addEventListener('click', loadData);

  // keyboard navigation inside the company list
  companyListEl.addEventListener('keydown', ev => {
    const items = Array.from(companyListEl.querySelectorAll('.company-item'));
    if(!items.length) return;
    const cur = items.findIndex(it => it.classList.contains('active'));
    if(ev.key === 'ArrowDown'){ ev.preventDefault(); const next = Math.min(cur+1, items.length-1); items[next].focus(); items[next].click(); }
    if(ev.key === 'ArrowUp'){ ev.preventDefault(); const prev = Math.max(cur-1, 0); items[prev].focus(); items[prev].click(); }
  });

  await loadData();
  </script>
</body>
</html>
